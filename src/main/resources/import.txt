
CREATE DATABASE crypto;

CREATE TABLE tb_blockchain_master (
  upd_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  symbol VARCHAR(10) NOT NULL,
  best_height BIGINT NOT NULL DEFAULT 0,
  sync_height BIGINT NOT NULL DEFAULT 0,
  decimals INTEGER NOT NULL DEFAULT 8,
  last_tx_fee DECIMAL(10,8) DEFAULT 0,
  owner_wallet VARCHAR(128),
  last_gas_price DECIMAL(8,4) DEFAULT 0,
  last_gas_used DECIMAL(8,4) DEFAULT 0,
  PRIMARY KEY (symbol)
);

CREATE TABLE tb_user_address (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  uid INTEGER NOT NULL,
  address VARCHAR(128) NOT NULL,
  mnemonic_enc VARCHAR(500) NOT NULL,
  default_yn CHAR(1) NOT NULL DEFAULT 'Y',
  balance DECIMAL(24,8) NOT NULL DEFAULT 0,
  unconfirmed_balance DECIMAL(24,8) NOT NULL DEFAULT 0,
  account VARCHAR(100),
  tag VARCHAR(100),
  PRIMARY KEY (uid, address)
);

CREATE TABLE tb_trans (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  upd_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  uid INTEGER NOT NULL,
  txid VARCHAR(255) NOT NULL,
  category VARCHAR(10) NOT NULL,
  confirm INTEGER NOT NULL DEFAULT 0,
  notifiable CHAR(1) NOT NULL DEFAULT 'N',
  noti_cnt INTEGER NOT NULL DEFAULT 0,
  re_notify CHAR(1) NOT NULL DEFAULT 'N',
  amount DECIMAL(24,8) NOT NULL DEFAULT 0,
  error VARCHAR(200),
  tx_time BIGINT DEFAULT 0,
  fee DECIMAL(10,8),
  from_addr VARCHAR(128),
  to_addr VARCHAR(128),
  block_id VARCHAR(128),
  order_id VARCHAR(20),
  from_tag VARCHAR(20),
  to_tag VARCHAR(20),
  tx_idx VARCHAR(10),
  PRIMARY KEY (txid, category)
);

CREATE TABLE tb_error (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY(START WITH 1, INCREMENT BY 1),
  error VARCHAR(200),
  PRIMARY KEY (id)
);